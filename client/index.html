<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admission Portal 2026 - P P Savani University</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { ppsuRed: '#EE3F36', ppsuDark: '#030000', ppsuGray: '#f4f4f4' },
                    fontFamily: { sans: ['Roboto', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #f8fafc; font-family: 'Roboto', sans-serif; }
        .step-active { border-color: #EE3F36; color: #EE3F36; font-weight: bold; }
        .step-inactive { border-color: #e2e8f0; color: #94a3b8; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #EE3F36; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-block; animation: marquee 25s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .marquee-container:hover .marquee-content { animation-play-state: paused; }
        .dashboard-scroll::-webkit-scrollbar { width: 6px; }
        .dashboard-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .dashboard-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .nav-link { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1.5rem; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; color: #9ca3af; cursor: pointer; }
        .nav-link:hover { color: white; background-color: rgba(255, 255, 255, 0.05); }
        .nav-link.active { background-color: rgba(255, 255, 255, 0.1); color: white; border-right: 4px solid #EE3F36; }
        .preview-container { width: 100%; height: 120px; background-color: #f3f4f6; border: 2px dashed #d1d5db; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; border-radius: 0.5rem; overflow: hidden; }
        .preview-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .preview-placeholder { color: #9ca3af; font-size: 2rem; }
    </style>
</head>
<body class="flex flex-col min-h-screen text-slate-800">

    <header id="mainHeader" class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showHome()">
                <img src="https://www.ppsu.ac.in/img/PPSUNAACA+Logo.png" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'flex items-center gap-2\'><i class=\'fa-solid fa-graduation-cap text-ppsuRed text-3xl\'></i><span class=\'text-2xl font-bold text-ppsuDark\'>PPSU</span></div>'" alt="PPSU Logo" class="h-14 object-contain">
            </div>
            <div class="hidden md:flex items-center gap-6">
                <button onclick="showHome()" class="text-sm font-medium hover:text-ppsuRed transition">Home</button>
                <button onclick="showLoginScreen()" class="text-sm font-medium hover:text-ppsuRed transition flex items-center gap-2"><i class="fa-solid fa-user-circle"></i> Student Login</button>
                <button onclick="showRegistration()" class="bg-ppsuRed text-white px-4 py-2 rounded-full text-sm font-bold shadow-sm hover:bg-red-700 transition">Admissions 2026-27</button>
            </div>
        </div>
    </header>

    <main id="mainContainer" class="flex-grow flex items-center justify-center py-8 px-4 sm:px-6">
        <div class="max-w-6xl w-full space-y-8">
            <div id="homeFlow" class="fade-in">
                <div class="bg-ppsuDark text-white py-2 mb-6 rounded-lg shadow-sm marquee-container relative">
                    <div class="marquee-content font-medium text-sm tracking-wide">
                        <span class="mx-6">üì¢ Admissions Open for Academic Year 2026-27</span><span class="mx-6 text-ppsuRed">|</span><span class="mx-6">üèÜ Ranked Among Top Private Universities in Gujarat</span><span class="mx-6 text-ppsuRed">|</span><span class="mx-6">üìÖ Entrance Exam scheduled for May 15th, 2026</span><span class="mx-6 text-ppsuRed">|</span><span class="mx-6">üéì 100% Placement Assistance provided</span>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100 mb-8">
                    <div class="md:flex">
                        <div class="p-8 md:w-3/5 flex flex-col justify-center">
                            <span class="text-ppsuRed font-bold tracking-widest uppercase text-xs mb-2">Education for All</span>
                            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Welcome to <br><span class="text-ppsuRed">P P Savani University</span></h1>
                            <p class="text-gray-600 mb-8 leading-relaxed">P P Savani University is a global center of excellence in education, committed to nurturing the leaders of tomorrow through holistic development.</p>
                            <div class="flex flex-wrap gap-4">
                                <button onclick="showRegistration()" class="bg-ppsuRed text-white px-8 py-3 rounded-lg text-lg font-bold shadow-lg hover:bg-red-700 transition transform hover:-translate-y-1">Apply Now <i class="fa-solid fa-arrow-right ml-2"></i></button>
                                <button onclick="showLoginScreen()" class="bg-white text-gray-700 border border-gray-300 px-8 py-3 rounded-lg text-lg font-medium hover:bg-gray-50 transition">Existing Student?</button>
                            </div>
                        </div>
                        <div class="bg-slate-100 md:w-2/5 relative min-h-[300px] flex items-center justify-center overflow-hidden">
                             <div class="absolute inset-0 opacity-10 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-red-500 via-gray-900 to-black"></div>
                             <div class="text-center z-10 p-6">
                                <div class="w-32 h-32 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg"><i class="fa-solid fa-building-columns text-5xl text-ppsuRed"></i></div>
                                <h3 class="text-xl font-bold text-gray-800">Established Legacy</h3>
                                <p class="text-sm text-gray-500 mt-1">Nurturing Mind, Body and Soul since 1987</p>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="registrationFlow" class="hidden">
                <div class="flex justify-center items-center mb-8">
                    <div class="flex items-center w-full max-w-sm relative">
                        <div id="step1-indicator" class="flex flex-col items-center relative z-10"><div class="w-10 h-10 rounded-full border-2 bg-white flex items-center justify-center transition-all duration-300 step-active">1</div><span class="text-xs mt-2 font-medium text-ppsuRed">Register</span></div>
                        <div class="flex-auto border-t-2 border-gray-200 absolute top-5 w-full left-0 z-0"></div>
                        <div id="step2-indicator" class="flex flex-col items-center ml-auto relative z-10"><div class="w-10 h-10 rounded-full border-2 bg-white flex items-center justify-center transition-all duration-300 step-inactive">2</div><span class="text-xs mt-2 font-medium text-gray-400">Payment</span></div>
                        <div id="step3-indicator" class="flex flex-col items-center ml-auto relative z-10"><div class="w-10 h-10 rounded-full border-2 bg-white flex items-center justify-center transition-all duration-300 step-inactive">3</div><span class="text-xs mt-2 font-medium text-gray-400">Credentials</span></div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
                    <div class="bg-ppsuDark p-4 text-center"><h2 class="text-white text-xl font-bold uppercase">Admission Portal</h2></div>
                    
                    <div id="step1-content">
                        <div class="md:flex">
                            <div class="hidden md:block md:w-1/3 bg-slate-50 border-r border-slate-100 p-8">
                                <h3 class="text-xl font-bold text-gray-800 mb-6">Why PPSU?</h3>
                                <div class="space-y-6">
                                    <div class="flex gap-4"><div class="flex-shrink-0 w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-ppsuRed"><i class="fa-solid fa-university"></i></div><div><h4 class="font-bold text-sm text-gray-900">UGC Recognized</h4><p class="text-xs text-gray-500 mt-1">State Private University established under Gujarat Act.</p></div></div>
                                    <div class="flex gap-4"><div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600"><i class="fa-solid fa-book-open"></i></div><div><h4 class="font-bold text-sm text-gray-900">Legacy</h4><p class="text-xs text-gray-500 mt-1">P P Savani Group.</p></div></div>
                                </div>
                            </div>
                            <div class="w-full md:w-2/3 p-8">
                                <form id="registrationForm" onsubmit="handleRegistration(event)">
                                    <div class="space-y-5">
                                        <div><label class="block text-sm font-medium text-gray-700">Full Name (As per Aadhaar)</label><input type="text" id="fullName" required class="block w-full px-3 py-2.5 border rounded-lg focus:ring-ppsuRed focus:border-ppsuRed sm:text-sm"></div>
                                        <div><label class="block text-sm font-medium text-gray-700">Aadhaar Number</label><input type="text" id="aadhaar" required maxlength="12" pattern="\d{12}" class="block w-full px-3 py-2.5 border rounded-lg sm:text-sm" oninput="this.value = this.value.replace(/[^0-9]/g, '')"></div>
                                        <div><label class="block text-sm font-medium text-gray-700">Date of Birth</label><input type="date" id="dob" required class="block w-full px-3 py-2.5 border rounded-lg sm:text-sm"></div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Select Course</label>
                                            <select id="course" required class="block w-full px-3 py-2.5 border rounded-lg sm:text-sm bg-white">
                                                <option value="" disabled selected>Select a program...</option>
                                                <optgroup label="Engineering"><option value="B.Tech Computer Engineering">B.Tech Computer Engineering</option><option value="B.Tech Civil Engineering">B.Tech Civil Engineering</option></optgroup>
                                                <optgroup label="Management"><option value="BBA">BBA</option><option value="MBA">MBA</option></optgroup>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Mobile Number</label>
                                            <div class="relative flex gap-2">
                                                <input type="tel" id="mobile" required maxlength="10" pattern="\d{10}" class="block w-full px-3 py-2.5 border rounded-lg sm:text-sm" oninput="this.value = this.value.replace(/[^0-9]/g, ''); resetMobileVerification()">
                                                <button type="button" id="sendOtpBtn" onclick="sendOTP()" class="px-4 border rounded-lg bg-gray-800 text-white text-sm">Send OTP</button>
                                                <div id="verifiedBadge" class="hidden flex items-center justify-center px-4 bg-green-100 text-green-700 rounded-lg text-sm border border-green-200">Verified</div>
                                            </div>
                                            <div id="otpSection" class="hidden mt-3 p-4 bg-slate-50 rounded-lg border fade-in">
                                                <div class="flex gap-3"><input type="text" id="otpInput" maxlength="4" class="block w-full px-3 py-2 border rounded-lg text-center font-bold" placeholder="XXXX"><button type="button" onclick="verifyOTP()" class="px-5 bg-ppsuRed text-white rounded-lg text-sm font-bold">Verify</button></div>
                                                <p class="text-xs text-blue-500 mt-2">Demo OTP: <strong>1234</strong></p>
                                            </div>
                                        </div>
                                        <div><label class="block text-sm font-medium text-gray-700">Referral Name</label><input type="text" id="referral" required class="block w-full px-3 py-2.5 border rounded-lg sm:text-sm" placeholder="Enter Referral Name (Mandatory)"></div>
                                        <div class="pt-4"><button type="submit" class="w-full py-3 px-4 bg-ppsuRed text-white font-bold rounded-lg hover:bg-red-700 transition">Proceed to Payment</button></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div id="step2-content" class="hidden p-8">
                        <div class="bg-slate-50 rounded-lg p-6 border border-slate-200 mb-6">
                            <div class="flex justify-between border-b pb-4 mb-4"><span class="text-gray-600 font-medium">Student Name</span><span id="summaryName" class="font-bold"></span></div>
                            <div class="flex justify-between items-center mb-4 pb-4 border-b border-slate-200"><span class="text-gray-600 font-medium">Course</span><span id="summaryCourse" class="font-bold text-gray-900"></span></div>
                            <div class="flex justify-between items-center"><span class="text-lg font-bold text-ppsuRed">Admission Fee</span><span class="text-2xl font-bold text-ppsuRed">‚Çπ12,500</span></div>
                        </div>
                        <button onclick="processPayment()" class="w-full py-3 px-4 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700">Pay Securely Now</button>
                        <div id="paymentLoader" class="hidden fixed inset-0 bg-white/90 z-20 flex flex-col items-center justify-center"><div class="loader"></div></div>
                    </div>
                    
                    <div id="step3-content" class="hidden p-8 text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fa-solid fa-check text-3xl text-green-600"></i></div>
                        <h2 class="text-2xl font-bold mb-2">Registration Successful!</h2>
                        <div class="bg-blue-50 border border-blue-100 rounded-lg p-5 mb-6 text-left">
                             <p class="text-sm">Username: <span id="credUsername" class="font-bold"></span></p>
                             <p class="text-sm">Password: <span id="credPassword" class="font-bold"></span></p>
                             <p class="text-xs text-gray-500 mt-2">App ID: <span id="credAppId"></span></p>
                        </div>
                        <button onclick="downloadReceipt('Admission Fee', 12500)" class="w-full py-3 border border-gray-300 rounded-lg mb-3">Download Receipt</button>
                        <button onclick="showLoginScreen()" class="w-full py-3 bg-ppsuRed text-white rounded-lg font-bold">Login</button>
                    </div>
                </div>
            </div>

            <div id="loginFlow" class="hidden">
                 <div class="max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
                    <div class="bg-ppsuDark p-6 text-center">
                        <img src="https://www.ppsu.ac.in/img/PPSUNAACA+Logo.png" class="h-10 mx-auto mb-4 bg-white p-1 rounded">
                        <h2 class="text-white text-xl font-bold uppercase">Student Login</h2>
                    </div>
                    <div class="p-8">
                        <form onsubmit="handleLogin(event)">
                            <div class="space-y-4">
                                <div><label class="block text-sm font-medium text-gray-700">Mobile Number</label><input type="tel" id="loginMobile" required class="block w-full px-3 py-2 border rounded-lg"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Password (DOB)</label><input type="password" id="loginPass" required class="block w-full px-3 py-2 border rounded-lg"></div>
                                <button type="submit" class="w-full py-3 bg-ppsuDark text-white rounded-lg font-bold hover:bg-gray-800">Login</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="dashboardFlow" class="hidden fixed inset-0 z-[60] bg-slate-50 flex overflow-hidden">
        <aside class="w-64 bg-ppsuDark text-white flex flex-col hidden md:flex h-full shadow-2xl">
            <div class="h-20 flex items-center gap-2 px-6 bg-black/30 border-b border-white/10">
                <i class="fa-solid fa-graduation-cap text-ppsuRed text-2xl"></i>
                <span class="text-xl font-bold">PPSU Portal</span>
            </div>
            <div class="p-6 border-b border-white/10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-ppsuRed flex items-center justify-center font-bold text-lg"><span id="sidebarInitials">S</span></div>
                    <div><p id="sidebarName" class="text-sm font-bold truncate w-32">Student</p><p id="sidebarAppId" class="text-xs text-gray-400 font-mono">APP0000</p></div>
                </div>
            </div>
            <nav class="flex-1 py-4 space-y-1 overflow-y-auto">
                <a onclick="switchDashTab('home')" id="nav-home" class="nav-link active"><i class="fa-solid fa-chart-pie w-5"></i> Overview</a>
                <a onclick="switchDashTab('app')" id="nav-app" class="nav-link"><i class="fa-solid fa-file-user w-5"></i> My Application</a>
                <a onclick="switchDashTab('hostel')" id="nav-hostel" class="nav-link"><i class="fa-solid fa-bed w-5"></i> Hostel Booking</a>
                <a onclick="switchDashTab('certs')" id="nav-certs" class="nav-link"><i class="fa-solid fa-file-circle-check w-5"></i> Documents</a>
                <a onclick="switchDashTab('idcard')" id="nav-idcard" class="nav-link"><i class="fa-solid fa-id-card w-5"></i> Digital ID Card</a>
                <a onclick="switchDashTab('fees')" id="nav-fees" class="nav-link"><i class="fa-solid fa-table-list w-5"></i> Fee Structure</a>
                <a onclick="switchDashTab('receipts')" id="nav-receipts" class="nav-link"><i class="fa-solid fa-receipt w-5"></i> Receipts</a>
            </nav>
            <div class="p-4 border-t border-white/10">
                <button onclick="logout()" class="w-full flex items-center justify-center gap-2 py-2 px-4 rounded bg-white/10 hover:bg-red-600/80 transition text-sm"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
            </div>
        </aside>

        <div class="flex-1 flex flex-col h-full overflow-hidden relative">
            <header class="bg-white shadow-sm h-16 flex items-center justify-between px-4 md:px-8 border-b border-gray-200">
                 <div class="flex items-center gap-3 md:hidden"><img src="https://www.ppsu.ac.in/img/PPSUNAACA+Logo.png" class="h-8"></div>
                <h1 id="dashPageTitle" class="text-xl font-bold text-gray-800">Overview</h1>
                <div class="flex items-center gap-4">
                    <span id="appFeeBadge" class="hidden px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full border border-green-200">App Fee Paid</span>
                    <button class="md:hidden text-gray-500" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i></button>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-8 dashboard-scroll bg-slate-50">
                <div id="dash-home" class="max-w-5xl mx-auto fade-in">
                     <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome Back, <span id="dashNameHome" class="text-ppsuRed">Student</span>!</h2>
                        <p id="dashWelcomeMsg" class="text-gray-500 text-sm">Please complete your application.</p>
                     </div>
                </div>

                <div id="dash-app" class="max-w-4xl mx-auto hidden fade-in">
                    <form onsubmit="handleApplicationSubmit(event)" id="appFormDetails" class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="p-6 border-b border-gray-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Personal Details</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                                <div><label class="text-xs text-gray-500">Full Name</label><input type="text" id="appFullName" readonly class="w-full bg-slate-100 border rounded px-3 py-2 cursor-not-allowed"></div>
                                <div><label class="text-xs text-gray-500">Mobile</label><input type="text" id="appMobile" readonly class="w-full bg-slate-100 border rounded px-3 py-2 cursor-not-allowed"></div>
                                <div><label class="text-xs text-gray-500">Aadhaar Number</label><input type="text" id="appAadhaar" readonly class="w-full bg-slate-100 border rounded px-3 py-2 cursor-not-allowed"></div>
                                <div><label class="text-xs text-gray-500">Course Applied</label><input type="text" id="appCourse" readonly class="w-full bg-slate-100 border rounded px-3 py-2 cursor-not-allowed"></div>
                                
                                <div class="md:col-span-2">
                                    <label class="text-xs text-gray-700 font-bold">Email Address</label>
                                    <input type="email" id="appEmail" required class="w-full border rounded px-3 py-2 focus:border-ppsuRed outline-none" placeholder="Enter valid email">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="text-xs text-gray-700 font-bold">Residential Address</label>
                                    <input type="text" id="appAddress" required class="w-full border rounded px-3 py-2 focus:border-ppsuRed outline-none" placeholder="House No, Street">
                                </div>
                                <div><label class="text-xs text-gray-700 font-bold">City</label><input type="text" id="appCity" required class="w-full border rounded px-3 py-2"></div>
                                <div><label class="text-xs text-gray-700 font-bold">State</label><input type="text" id="appState" required class="w-full border rounded px-3 py-2"></div>
                                <div><label class="text-xs text-gray-700 font-bold">Pincode</label><input type="text" id="appPincode" required class="w-full border rounded px-3 py-2"></div>
                            </div>
                        </div>
                        <div class="p-6 bg-slate-50 border-t border-gray-200 text-right flex justify-end gap-4">
                             <button type="button" id="downloadAppBtn" onclick="downloadApplicationForm()" class="hidden border border-ppsuRed text-ppsuRed px-6 py-3 rounded-lg font-bold hover:bg-red-50">Download PDF</button>
                             <button type="submit" id="submitAppBtn" class="bg-ppsuDark text-white px-8 py-3 rounded-lg font-bold hover:bg-gray-800 shadow-lg">Pay Application Fee (‚Çπ1,200) & Submit</button>
                        </div>
                    </form>
                </div>

                <div id="dash-certs" class="max-w-6xl mx-auto hidden fade-in">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Upload Documents</h3>
                    <p class="text-sm text-red-500 mb-6"><i class="fa-solid fa-circle-exclamation mr-1"></i> Note: Maximum file size allowed is 10 MB per document.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm text-center">
                            <h4 class="font-bold mb-3">10th Marksheet</h4>
                            <div class="preview-container"><img id="preview10th" class="preview-img"><i class="fa-solid fa-image preview-placeholder" id="ph10th"></i></div>
                            <input type="file" id="file10th" class="block w-full text-xs text-slate-500 mb-3" onchange="handleFileSelect('file10th', 'preview10th', 'ph10th')">
                            <button onclick="uploadCert('10th Marksheet', 'btn10th')" id="btn10th" class="w-full py-2 bg-gray-800 text-white rounded text-sm hover:bg-black">Upload</button>
                        </div>
                        
                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm text-center">
                            <h4 class="font-bold mb-3">12th Marksheet</h4>
                            <div class="preview-container"><img id="preview12th" class="preview-img"><i class="fa-solid fa-image preview-placeholder" id="ph12th"></i></div>
                            <input type="file" id="file12th" class="block w-full text-xs text-slate-500 mb-3" onchange="handleFileSelect('file12th', 'preview12th', 'ph12th')">
                            <button onclick="uploadCert('12th Marksheet', 'btn12th')" id="btn12th" class="w-full py-2 bg-gray-800 text-white rounded text-sm hover:bg-black">Upload</button>
                        </div>

                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm text-center">
                            <h4 class="font-bold mb-3">Transfer Certificate (TC)</h4>
                            <div class="preview-container"><img id="previewTC" class="preview-img"><i class="fa-solid fa-image preview-placeholder" id="phTC"></i></div>
                            <input type="file" id="fileTC" class="block w-full text-xs text-slate-500 mb-3" onchange="handleFileSelect('fileTC', 'previewTC', 'phTC')">
                            <button onclick="uploadCert('TC', 'btnTC')" id="btnTC" class="w-full py-2 bg-gray-800 text-white rounded text-sm hover:bg-black">Upload</button>
                        </div>

                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm text-center">
                            <h4 class="font-bold mb-3">Student Aadhaar</h4>
                            <div class="preview-container"><img id="previewAadhaar" class="preview-img"><i class="fa-solid fa-id-card preview-placeholder" id="phAadhaar"></i></div>
                            <input type="file" id="fileAadhaar" class="block w-full text-xs text-slate-500 mb-3" onchange="handleFileSelect('fileAadhaar', 'previewAadhaar', 'phAadhaar')">
                            <button onclick="uploadCert('Student Aadhaar', 'btnAadhaar')" id="btnAadhaar" class="w-full py-2 bg-gray-800 text-white rounded text-sm hover:bg-black">Upload</button>
                        </div>

                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm text-center">
                            <h4 class="font-bold mb-3">Father's Aadhaar</h4>
                            <div class="preview-container"><img id="previewFather" class="preview-img"><i class="fa-solid fa-id-card preview-placeholder" id="phFather"></i></div>
                            <input type="file" id="fileFather" class="block w-full text-xs text-slate-500 mb-3" onchange="handleFileSelect('fileFather', 'previewFather', 'phFather')">
                            <button onclick="uploadCert('Father Aadhaar', 'btnFather')" id="btnFather" class="w-full py-2 bg-gray-800 text-white rounded text-sm hover:bg-black">Upload</button>
                        </div>

                        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm text-center">
                            <h4 class="font-bold mb-3">Mother's Aadhaar</h4>
                            <div class="preview-container"><img id="previewMother" class="preview-img"><i class="fa-solid fa-id-card preview-placeholder" id="phMother"></i></div>
                            <input type="file" id="fileMother" class="block w-full text-xs text-slate-500 mb-3" onchange="handleFileSelect('fileMother', 'previewMother', 'phMother')">
                            <button onclick="uploadCert('Mother Aadhaar', 'btnMother')" id="btnMother" class="w-full py-2 bg-gray-800 text-white rounded text-sm hover:bg-black">Upload</button>
                        </div>
                    </div>
                </div>

                <div id="dash-hostel" class="hidden">Hostel Content</div>
                <div id="dash-idcard" class="hidden">ID Card Content</div>
                <div id="dash-fees" class="hidden">Fees Content</div>
                <div id="dash-receipts" class="hidden">Receipts Content</div>
            </div>
        </div>
    </div>

    <div id="appPayModal" class="hidden fixed inset-0 z-[70] bg-black/60 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 text-center">
            <h3 class="text-2xl font-bold mb-2">Confirm Payment</h3>
            <p class="text-gray-500 mb-6">Processing Application Fee</p>
            <div class="bg-slate-50 p-4 rounded mb-6"><div class="flex justify-between font-bold text-lg"><span>Total</span><span class="text-ppsuRed">‚Çπ1,200.00</span></div></div>
            <button onclick="confirmAppPayment()" class="w-full py-3 bg-green-600 text-white rounded font-bold hover:bg-green-700">Pay Securely</button>
            <button onclick="closeAppPayModal()" class="mt-3 text-sm text-gray-500">Cancel</button>
        </div>
    </div>

    <script>
        let formData = { fullName: '', aadhaar: '', dob: '', course: '', mobile: '', referral: '', applicationId: '' };
        let isMobileVerified = false, isAppFeePaid = false;
        
        const getEl = (id) => document.getElementById(id);
        const hide = (id) => getEl(id).classList.add('hidden');
        const show = (id) => getEl(id).classList.remove('hidden');

        // Helpers
        function resetMobileVerification() { if(isMobileVerified){ isMobileVerified=false; hide('verifiedBadge'); show('sendOtpBtn'); } }
        function sendOTP() { if(getEl('mobile').value.length!=10) return alert("Invalid Mobile"); getEl('sendOtpBtn').innerText="Sending..."; setTimeout(()=>{ getEl('sendOtpBtn').innerText="Resend"; show('otpSection'); getEl('otpInput').focus(); alert("OTP: 1234"); },1000); }
        function verifyOTP() { if(getEl('otpInput').value==='1234'){ isMobileVerified=true; hide('otpSection'); hide('sendOtpBtn'); show('verifiedBadge'); getEl('mobile').readOnly=true; } else alert("Wrong OTP"); }
        function goToStep(n) { hide('step1-content'); hide('step2-content'); hide('step3-content'); show('step'+n+'-content'); }

        // 1. REGISTER (Basic Info)
        async function handleRegistration(e) {
            e.preventDefault();
            if (!isMobileVerified) return alert("Please verify mobile number first.");
            
            formData = {
                fullName: getEl('fullName').value,
                aadhaar: getEl('aadhaar').value,
                dob: getEl('dob').value,
                course: getEl('course').value,
                mobile: getEl('mobile').value,
                referral: getEl('referral').value,
                applicationId: '2026' + Math.floor(100000 + Math.random() * 900000)
            };

            const submitBtn = document.querySelector('#registrationForm button[type="submit"]');
            submitBtn.innerText = "Processing..."; submitBtn.disabled = true;

            try {
                const res = await fetch("https://ppsu-backend.onrender.com/api/register", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                if (res.ok) {
                    getEl('summaryName').innerText = formData.fullName;
                    getEl('summaryCourse').innerText = formData.course;
                    goToStep(2);
                } else alert("Registration failed.");
            } catch (err) { alert("Server error."); } 
            finally { submitBtn.innerText = "Proceed to Payment"; submitBtn.disabled = false; }
        }

        function processPayment() {
            show('paymentLoader');
            setTimeout(() => {
                hide('paymentLoader');
                getEl('credUsername').innerText = formData.mobile;
                getEl('credPassword').innerText = formData.dob;
                getEl('credAppId').innerText = formData.applicationId;
                goToStep(3);
            }, 2000);
        }

        // 2. SUBMIT APPLICATION (Address Info)
        async function handleApplicationSubmit(e) { 
            e.preventDefault();
            const updateData = {
                applicationId: formData.applicationId,
                email: getEl('appEmail').value,
                address: getEl('appAddress').value,
                city: getEl('appCity').value,
                state: getEl('appState').value,
                pincode: getEl('appPincode').value
            };
            const btn = getEl('submitAppBtn'); btn.innerText = "Saving...";
            
            try {
                const res = await fetch("https://ppsu-backend.onrender.com/api/update-application", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateData)
                });
                if(res.ok) {
                    // Update Local State
                    formData.email = updateData.email;
                    formData.address = updateData.address;
                    formData.city = updateData.city;
                    formData.state = updateData.state;
                    formData.pincode = updateData.pincode;
                    show('appPayModal');
                } else alert("Failed to update details.");
            } catch(err) { alert("Error saving details."); }
            finally { btn.innerText = "Pay Application Fee (‚Çπ1,200) & Submit"; }
        }

        function confirmAppPayment() {
            hide('appPayModal'); isAppFeePaid = true;
            getEl('submitAppBtn').innerText = "Submitted Successfully"; getEl('submitAppBtn').className = "bg-green-600 text-white px-8 py-3 rounded-lg font-bold cursor-not-allowed";
            show('downloadAppBtn');
            alert("Application Submitted!");
        }
        function closeAppPayModal() { hide('appPayModal'); }

        // 3. UPLOAD (With Fixed Logic)
        async function uploadCert(docType, btnId) {
            // Get name from formData or Dashboard (fallback for after login)
            const studentName = formData.fullName || getEl('dashNameHome').innerText || "Student";
            const fileInput = getEl(btnId.replace('btn', 'file'));
            
            if (!fileInput.files[0]) return alert("Select file first.");

            const btn = getEl(btnId); btn.innerText = "Uploading..."; btn.disabled = true;
            
            const data = new FormData();
            data.append("file", fileInput.files[0]);
            data.append("studentName", studentName);
            data.append("docType", docType);

            try {
                const res = await fetch("https://ppsu-backend.onrender.com/api/upload", { method: 'POST', body: data });
                if (res.ok) { alert("Uploaded!"); btn.innerText = "Done ‚úì"; btn.className = "w-full py-2 bg-green-600 text-white rounded text-sm"; }
                else { const txt = await res.text(); alert("Failed: " + txt); btn.innerText = "Upload"; btn.disabled = false; }
            } catch (err) { alert("Network Error"); btn.innerText = "Upload"; btn.disabled = false; }
        }
        
        function handleFileSelect(inp, prev, ph) {
            const f = getEl(inp).files[0];
            if(f) { const r = new FileReader(); r.onload = e => { getEl(prev).src=e.target.result; getEl(prev).style.display='block'; getEl(ph).style.display='none'; }; r.readAsDataURL(f); }
        }

        // Navigation
        function showHome() { hide('loginFlow'); hide('dashboardFlow'); hide('registrationFlow'); show('homeFlow'); }
        function showRegistration() { hide('homeFlow'); show('registrationFlow'); goToStep(1); }
        function showLoginScreen() { hide('homeFlow'); show('loginFlow'); }
        
        function handleLogin(e) {
            e.preventDefault();
            const name = formData.fullName || "Student Name";
            const id = formData.applicationId || "20260001";
            
            getEl('sidebarName').innerText = name; getEl('sidebarAppId').innerText = id; getEl('dashNameHome').innerText = name;
            
            // Pre-fill read-only data
            getEl('appFullName').value = name; 
            getEl('appMobile').value = formData.mobile || "9876543210"; 
            getEl('appAadhaar').value = formData.aadhaar || "123412341234";
            
            hide('loginFlow'); show('dashboardFlow');
        }
        
        function logout() { hide('dashboardFlow'); showHome(); }
        
        function switchDashTab(tab) {
            ['home','app','hostel','certs','fees','receipts','idcard'].forEach(t => {
                if(t===tab) { getEl('nav-'+t).classList.add('active'); show('dash-'+t); }
                else { getEl('nav-'+t).classList.remove('active'); hide('dash-'+t); }
            });
        }
    </script>
</body>
</html>